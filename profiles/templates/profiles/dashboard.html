{% extends "base.html" %}
{% load thumbnail %}

{% block title %}
{% if user.user_profile.first_name %}
    Welcome to your dashboard {{user.user_profile.first_name}}
{% elif user.user_profile.username  %}
    Welcome to your dashboard {{user.user_profile.username}}
{% else %}
    Welcome to your dashboard {{user.email}}
{% endif %}
{% endblock title %}


{% block content %}
{% for msg in messages %}
<div class="error-div"><span>{{msg}}</span></div>
{% endfor %}
{% if user.user_profile.first_name %}
    <h1>Welcome to your dashboard {{user.user_profile.first_name}}</h1>
{% elif user.user_profile.username  %}
    <h1>Welcome to your dashboard {{user.user_profile.username}}</h1>
{% else %}
    <h1>Welcome to your dashboard {{user.email}}</h1>
{% endif %}

{% with total_images_created=paginator.count %}

<p>Welcome to your dashboard. You have bookmarked 
{{ total_images_created }} image{{ total_images_created|pluralize }}.</p>

{% endwith %}

<p>Drag the following button to your bookmarks toolbar to bookmark images from other websites â†’ 
<a href="javascript:{% include "images/bookmarklet_launcher.js" %}" class="button">Bookmark it</a></p>
<p>You can also <a href="{% url "profiles:edit_profiles" %}">
  edit your profile</a> or <a href="{% url "password_change" %}">
  change your password</a>.
</p>

<div id="image-list-div">
  {% include "profiles/list_ajax.html" %}
</div>

{% endblock content %}


{% block domready %}

var page = 1;
var empty_page = false;
var block_request = false;

$(window).scroll(function() {
    var margin = $(document).height() - $(window).height() - 200;
    if($(window).scrollTop() > margin && empty_page == false && block_request == false) {
        block_request = true;
        page += 1;
        $.get('?page=' + page, function(data) {
            if(data == '') {
                empty_page = true;
            }
            else {
                block_request = false;
                $('#image-list-div').append(data);
                }
        });
    }

});

{% endblock domready %}